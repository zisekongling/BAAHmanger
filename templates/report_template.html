<!DOCTYPE html>
<html>
<head>
    <title>BAAHä»»åŠ¡æ•°æ®æŠ¥å‘Š - è”šè“æ¡£æ¡ˆä¸»é¢˜</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* ã€Šè”šè“æ¡£æ¡ˆã€‹ä¸»é¢˜CSSå˜é‡å®šä¹‰ - ä¿®æ”¹ä¸ºæ–°çš„è“è‰²ç³»é…è‰² */
        :root {
            /* ä¸»è‰²è°ƒ - åŸºäºæä¾›çš„è“è‰²ç³» */
            --ba-primary-blue: #3498db;
            --ba-primary-blue-light: #34c2db;
            --ba-primary-blue-dark: #346edb;
            
            /* è¾…åŠ©è‰² - ä½¿ç”¨æä¾›çš„å…¶ä»–è“è‰² */
            --ba-accent-cyan: #34dbcb;
            --ba-accent-blue: #3445db;
            --ba-accent-green: #c8e6c9;
            
            /* ä¸­æ€§è‰² - ç®€æ´å¹²å‡€çš„åŸºç¡€è‰²è°ƒ */
            --ba-white: #ffffff;
            --ba-gray-light: #f5f5f5;
            --ba-gray: #e0e0e0;
            --ba-gray-dark: #616161;
            --ba-black: #212121;
            
            /* è¯­ä¹‰è‰² */
            --ba-positive: #34dbcb;
            --ba-negative: #db3445;
            --ba-warning: #db8c34;
            
            /* å­—ä½“ */
            --ba-font-primary: "Segoe UI", "Hiragino Sans", "Yu Gothic UI", "Meiryo UI", sans-serif;
            
            /* é˜´å½±æ•ˆæœ - è½»å¾®æå‡å±‚æ¬¡æ„Ÿ */
            --ba-shadow-light: 0 2px 4px rgba(52, 152, 219, 0.1);
            --ba-shadow-medium: 0 4px 8px rgba(52, 152, 219, 0.15);
            --ba-shadow-large: 0 8px 16px rgba(52, 152, 219, 0.2);
            
            /* åœ†è§’ */
            --ba-border-radius-small: 8px;
            --ba-border-radius-medium: 12px;
            --ba-border-radius-large: 16px;
            
            /* é€æ˜åº¦æ•ˆæœ - ä½“ç°é€æ˜æ„Ÿ */
            --ba-transparency-light: rgba(255, 255, 255, 0.7);
            --ba-transparency-medium: rgba(255, 255, 255, 0.5);
            
            /* å¸ƒå±€å˜é‡ */
            --sidebar-width: 280px;
        }

        /* åŸºç¡€æ ·å¼é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--ba-font-primary);
            background: linear-gradient(135deg, var(--ba-primary-blue-light) 0%, #e0f7fa 100%);
            color: var(--ba-black);
            line-height: 1.6;
            min-height: 100vh;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* ä¾§è¾¹æ æ ·å¼ - è”šè“æ¡£æ¡ˆä¸»é¢˜ */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--ba-primary-blue) 0%, var(--ba-accent-blue) 100%);
            color: var(--ba-white);
            box-shadow: var(--ba-shadow-large);
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 25px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h2 {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--ba-white);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .sidebar-menu {
            list-style: none;
            padding: 20px 0;
        }

        .sidebar-menu li {
            margin: 8px 0;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 16px 25px;
            color: var(--ba-white);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            background: rgba(255, 255, 255, 0.05);
            margin: 0 15px;
            border-radius: var(--ba-border-radius-small);
            font-weight: 500;
        }

        .sidebar-menu a:hover {
            background: rgba(255, 255, 255, 0.15);
            border-left-color: var(--ba-accent-cyan);
            transform: translateX(5px);
        }

        .sidebar-menu a.active {
            background: rgba(255, 255, 255, 0.2);
            border-left-color: var(--ba-accent-cyan);
            font-weight: 600;
            box-shadow: var(--ba-shadow-light);
        }

        .sidebar-menu i {
            margin-right: 15px;
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* å¡ç‰‡ç»„ä»¶ */
        .ba-card {
            background: var(--ba-transparency-light);
            backdrop-filter: blur(10px);
            border-radius: var(--ba-border-radius-medium);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--ba-shadow-light);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        /* æ ‡é¢˜æ ·å¼ */
        .ba-heading {
            color: var(--ba-accent-blue);
            margin-bottom: 20px;
            font-weight: 700;
        }

        .ba-heading--primary {
            font-size: 2.2rem;
            border-bottom: 3px solid var(--ba-primary-blue);
            padding-bottom: 15px;
            text-align: center;
        }

        .ba-heading--secondary {
            font-size: 1.6rem;
            border-left: 4px solid var(--ba-primary-blue);
            padding-left: 20px;
            margin-top: 30px;
            margin-bottom: 20px;
        }

        /* æŒ‰é’®æ ·å¼ */
        .ba-button {
            display: inline-block;
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--ba-primary-blue) 0%, var(--ba-accent-blue) 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--ba-shadow-light);
            text-align: center;
            text-decoration: none;
        }

        .ba-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--ba-shadow-medium);
        }

        .date-filter {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .date-filter button {
            padding: 12px 24px;
            background: transparent;
            border: 2px solid var(--ba-primary-blue);
            color: var(--ba-accent-blue);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .date-filter button:hover {
            background: var(--ba-primary-blue-light);
            transform: translateY(-2px);
        }

        .date-filter button.active {
            background: linear-gradient(135deg, var(--ba-primary-blue) 0%, var(--ba-accent-blue) 100%);
            color: white;
            border-color: var(--ba-primary-blue);
            box-shadow: var(--ba-shadow-light);
        }

        /* ç»Ÿè®¡å¡ç‰‡ç½‘æ ¼ */
        .ba-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .ba-stat-card {
            background: linear-gradient(135deg, var(--ba-primary-blue-light) 0%, var(--ba-accent-cyan) 100%);
            padding: 25px 20px;
            border-radius: var(--ba-border-radius-medium);
            text-align: center;
            border: 1px solid var(--ba-gray);
            backdrop-filter: blur(5px);
        }

        .ba-stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--ba-accent-blue);
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .ba-stat-label {
            font-size: 0.95rem;
            color: var(--ba-gray-dark);
            font-weight: 500;
        }

        /* è¡¨æ ¼æ ·å¼ */
        .ba-table-container {
            overflow-x: auto;
            border-radius: var(--ba-border-radius-medium);
            box-shadow: var(--ba-shadow-light);
            background: var(--ba-white);
            margin-top: 20px;
            max-height: 600px;
            overflow-y: auto;
            position: relative;
        }

        .ba-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .ba-table thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .ba-table th, .ba-table td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid var(--ba-gray);
        }

        .ba-table th {
            background: linear-gradient(135deg, var(--ba-primary-blue) 0%, var(--ba-accent-blue) 100%);
            color: white;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .ba-table tr:nth-child(even) {
            background-color: rgba(52, 194, 219, 0.1);
        }

        .ba-table tr:hover {
            background-color: rgba(52, 152, 219, 0.2);
        }

        /* é¢œè‰²çŠ¶æ€ç±» */
        .ba-positive {
            color: var(--ba-positive);
            font-weight: bold;
        }

        .ba-negative {
            color: var(--ba-negative);
            font-weight: bold;
        }

        .ba-warning {
            color: var(--ba-warning);
            font-weight: bold;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .sidebar-menu {
                display: flex;
                overflow-x: auto;
                padding: 15px;
                flex-wrap: nowrap;
            }
            
            .sidebar-menu li {
                flex: 0 0 auto;
                margin: 0 8px;
            }
            
            .sidebar-menu a {
                padding: 12px 20px;
                border-radius: 20px;
                border-left: none;
                border-bottom: 3px solid transparent;
                white-space: nowrap;
            }
            
            .sidebar-menu a.active {
                border-left: none;
                border-bottom: 3px solid var(--ba-accent-cyan);
            }
            
            .main-content {
                padding: 20px 15px;
            }
            
            .ba-heading--primary {
                font-size: 1.8rem;
            }
            
            .ba-heading--secondary {
                font-size: 1.4rem;
            }
            
            .ba-stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ä¾§è¾¹æ  -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2>ğŸ“­BAAHä»»åŠ¡æŠ¥å‘ŠğŸ“­</h2>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#stats" class="nav-link active" data-section="stats-section">
                    <i>ğŸ’¾</i>ç»Ÿè®¡æ•°æ®æ¦‚è§ˆ
                </a></li>
                <li><a href="#details" class="nav-link" data-section="details-section">
                    <i>ğŸ”</i>æ¯æ—¥è¯¦ç»†æ•°æ®
                </a></li>
                <li><a href="#weekly" class="nav-link" data-section="weekly-section">
                    <i>ğŸ“š</i>å‘¨åº¦åˆ†ææŠ¥å‘Š
                </a></li>
                <li><a href="#monthly" class="nav-link" data-section="monthly-section">
                    <i>ğŸ“’</i>æœˆåº¦åˆ†ææŠ¥å‘Š
                </a></li>
                <li><a href="#reduction" class="nav-link" data-section="reduction-section">
                    <i>ğŸ“‰</i>é’è¾‰çŸ³å‡å°‘é‡
                </a></li>
            </ul>
        </nav>
        
        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <!-- ç»Ÿè®¡æ•°æ®éƒ¨åˆ† -->
            <section id="stats-section" class="section active">
                <div class="ba-card">
                    <h1 class="ba-heading ba-heading--primary">BAAHä»»åŠ¡æ•°æ®æŠ¥å‘Š</h1>
                    <div style="text-align: center; color: var(--ba-gray-dark); margin-bottom: 20px;">
                        <p>æ•°æ®ç»Ÿè®¡æ—¶é—´: {{CURRENT_TIME}}</p>
                        <p>æ•°æ®èŒƒå›´: å…¨éƒ¨æ•°æ® (å…± {{TOTAL_DAYS}} å¤©)</p>
                    </div>
                    
                    <div class="date-filter">
                        <button onclick="filterData('all')" class="active">å…¨éƒ¨æ•°æ®</button>
                        <button onclick="filterData('week')">è¿‘ä¸€å‘¨</button>
                        <button onclick="filterData('month')">è¿‘ä¸€æœˆ</button>
                        <button onclick="filterData('year')">è¿‘ä¸€å¹´</button>
                    </div>
                    
                    <div id="stats-container">
                        <h2 class="ba-heading ba-heading--secondary">èµ„æºè·å–ç»Ÿè®¡</h2>
                        <div class="ba-stats-grid">
                            <div class="ba-stat-card">
                                <div class="ba-stat-value" id="total-days">{{TOTAL_DAYS}}</div>
                                <div class="ba-stat-label">æ€»ä»»åŠ¡å¤©æ•°</div>
                            </div>
                            <div class="ba-stat-card">
                                <div class="ba-stat-value" id="total-baah-diamond">{{TOTAL_BAAH_DIAMOND}}</div>
                                <div class="ba-stat-label">BAAHé’è¾‰çŸ³è·å¾—</div>
                            </div>
                            <div class="ba-stat-card">
                                <div class="ba-stat-value" id="total-net-diamond">{{TOTAL_NET_DIAMOND}}</div>
                                <div class="ba-stat-label">å‡€é’è¾‰çŸ³è·å¾—</div>
                            </div>
                            <div class="ba-stat-card">
                                <div class="ba-stat-value" id="total-draws">{{TOTAL_DRAWS}}</div>
                                <div class="ba-stat-label">å‡€é’è¾‰çŸ³æ€»æŠ½å¡</div>
                            </div>
                            <div class="ba-stat-card">
                                <div class="ba-stat-value" id="current-total-draws">{{CURRENT_TOTAL_DRAWS}}</div>
                                <div class="ba-stat-label">å½“å‰æ€»æŠ½å¡æ¬¡æ•°</div>
                            </div>
                            <div class="ba-stat-card">
                                <div class="ba-stat-value" id="total-baah-credit">{{TOTAL_BAAH_CREDIT}}</div>
                                <div class="ba-stat-label">BAAHä¿¡ç”¨ç‚¹è·å¾—(ä¸‡)</div>
                            </div>
                        </div>
                        
                        <h2 class="ba-heading ba-heading--secondary">æ—¥å‡æ•°æ®ç»Ÿè®¡</h2>
                        <div class="ba-stats-grid">
                            <div class="ba-stat-card">
                                <div class="ba-stat-value" id="avg-baah-diamond">{{AVG_BAAH_DIAMOND}}</div>
                                <div class="ba-stat-label">æ—¥å‡BAAHé’è¾‰çŸ³</div>
                            </div>
                            <div class="ba-stat-card">
                                <div class="ba-stat-value" id="avg-net-diamond">{{AVG_NET_DIAMOND}}</div>
                                <div class="ba-stat-label">æ—¥å‡å‡€é’è¾‰çŸ³</div>
                            </div>
                            <div class="ba-stat-card">
                                <div class="ba-stat-value" id="avg-baah-credit">{{AVG_BAAH_CREDIT}}</div>
                                <div class="ba-stat-label">æ—¥å‡BAAHä¿¡ç”¨ç‚¹(ä¸‡)</div>
                            </div>
                            <div class="ba-stat-card">
                                <div class="ba-stat-value" id="avg-duration">{{AVG_DURATION}}</div>
                                <div class="ba-stat-label">å¹³å‡ä»»åŠ¡æ—¶é•¿(åˆ†é’Ÿ)</div>
                            </div>
                        </div>
                        
                        <h2 class="ba-heading ba-heading--secondary">é’è¾‰çŸ³å‡å°‘ç»Ÿè®¡</h2>
                        <div class="ba-stats-grid">
                            <div class="ba-stat-card">
                                <div class="ba-stat-value" id="total-reduction">{{TOTAL_REDUCTION}}</div>
                                <div class="ba-stat-label">é’è¾‰çŸ³å‡å°‘æ€»é‡</div>
                            </div>
                            <div class="ba-stat-card">
                                <div class="ba-stat-value" id="reduction-draws">{{REDUCTION_DRAWS}}</div>
                                <div class="ba-stat-label">å‡å°‘å¯¹åº”æŠ½å¡æ¬¡æ•°</div>
                            </div>
                            <div class="ba-stat-card">
                                <div class="ba-stat-value" id="reduction-days">{{REDUCTION_DAYS}}</div>
                                <div class="ba-stat-label">é’è¾‰çŸ³å‡å°‘å¤©æ•°</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- æ¯æ—¥è¯¦ç»†æ•°æ®éƒ¨åˆ† -->
            <section id="details-section" class="section">
                <div class="ba-card">
                    <h2 class="ba-heading ba-heading--primary">æ¯æ—¥è¯¦ç»†æ•°æ®</h2>
                    <div class="ba-table-container">
                        <table class="ba-table">
                            <thead>
                                <tr>
                                    <th>æ—¥æœŸ</th>
                                    <th>å¼€å§‹é’è¾‰çŸ³</th>
                                    <th>ç»“æŸé’è¾‰çŸ³</th>
                                    <th>BAAHé’è¾‰çŸ³å¢ç›Š</th>
                                    <th>å‡€é’è¾‰çŸ³å¢ç›Š</th>
                                    <th>å¼€å§‹ä¿¡ç”¨ç‚¹</th>
                                    <th>ç»“æŸä¿¡ç”¨ç‚¹</th>
                                    <th>BAAHä¿¡ç”¨ç‚¹å¢ç›Š</th>
                                    <th>å‡€ä¿¡ç”¨ç‚¹å¢ç›Š</th>
                                    <th>ä»»åŠ¡æ—¶é•¿(åˆ†é’Ÿ)</th>
                                </tr>
                            </thead>
                            <tbody id="table-body">
                                {{TABLE_ROWS}}
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- å‘¨åº¦æŠ¥å‘Šéƒ¨åˆ† -->
            <section id="weekly-section" class="section">
                <div class="ba-card">
                    <h2 class="ba-heading ba-heading--primary">å‘¨åº¦åˆ†ææŠ¥å‘Š</h2>
                    <div class="ba-table-container">
                        <table class="ba-table">
                            <thead>
                                <tr>
                                    <th>å‘¨èŒƒå›´</th>
                                    <th>å¤©æ•°</th>
                                    <th>BAAHé’è¾‰çŸ³æ€»å¢ç›Š</th>
                                    <th>å‡€é’è¾‰çŸ³æ€»å¢ç›Š</th>
                                    <th>BAAHé’è¾‰çŸ³å¹³å‡å¢ç›Š</th>
                                    <th>å‡€é’è¾‰çŸ³å¹³å‡å¢ç›Š</th>
                                    <th>ä»»åŠ¡æ€»æ—¶é•¿</th>
                                    <th>ä»»åŠ¡å¹³å‡æ—¶é•¿</th>
                                </tr>
                            </thead>
                            <tbody id="weekly-body">
                                {{WEEKLY_ROWS}}
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- æœˆåº¦æŠ¥å‘Šéƒ¨åˆ† -->
            <section id="monthly-section" class="section">
                <div class="ba-card">
                    <h2 class="ba-heading ba-heading--primary">æœˆåº¦åˆ†ææŠ¥å‘Š</h2>
                    <div class="ba-table-container">
                        <table class="ba-table">
                            <thead>
                                <tr>
                                    <th>æœˆä»½</th>
                                    <th>å¤©æ•°</th>
                                    <th>BAAHé’è¾‰çŸ³æ€»å¢ç›Š</th>
                                    <th>å‡€é’è¾‰çŸ³æ€»å¢ç›Š</th>
                                    <th>BAAHé’è¾‰çŸ³å¹³å‡å¢ç›Š</th>
                                    <th>å‡€é’è¾‰çŸ³å¹³å‡å¢ç›Š</th>
                                    <th>ä»»åŠ¡æ€»æ—¶é•¿</th>
                                    <th>ä»»åŠ¡å¹³å‡æ—¶é•¿</th>
                                </tr>
                            </thead>
                            <tbody id="monthly-body">
                                {{MONTHLY_ROWS}}
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- é’è¾‰çŸ³å‡å°‘é‡éƒ¨åˆ† -->
            <section id="reduction-section" class="section">
                <div class="ba-card">
                    <h2 class="ba-heading ba-heading--primary">é’è¾‰çŸ³å‡å°‘é‡ç»Ÿè®¡</h2>
                    <div style="text-align: center; color: var(--ba-gray-dark); margin-bottom: 20px;">
                        <p>æ³¨ï¼šé’è¾‰çŸ³å‡å°‘é‡ = ä»Šå¤©å¼€å§‹é’è¾‰çŸ³ - æ˜¨å¤©ç»“æŸé’è¾‰çŸ³</p>
                    </div>
                    
                    <div class="date-filter">
                        <button onclick="filterReductionData('all')" class="active">å…¨éƒ¨æ•°æ®</button>
                        <button onclick="filterReductionData('week')">è¿‘ä¸€å‘¨</button>
                        <button onclick="filterReductionData('month')">è¿‘ä¸€æœˆ</button>
                        <button onclick="filterReductionData('year')">è¿‘ä¸€å¹´</button>
                    </div>
                    
                    <div class="ba-table-container">
                        <table class="ba-table">
                            <thead>
                                <tr>
                                    <th>æ—¥æœŸ</th>
                                    <th>å‰ä¸€å¤©ç»“æŸé’è¾‰çŸ³</th>
                                    <th>å½“å¤©å¼€å§‹é’è¾‰çŸ³</th>
                                    <th>é’è¾‰çŸ³å‡å°‘é‡</th>
                                    <th>å‡å°‘å¯¹åº”æŠ½æ•°</th>
                                </tr>
                            </thead>
                            <tbody id="reduction-body">
                                {{REDUCTION_ROWS}}
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>
    </div>
    
    <script>
        // åµŒå…¥æ•°æ® - ä½¿ç”¨JSONå­—ç¬¦ä¸²ï¼Œéœ€è¦è§£æ
        const allDataStr = {{DATA_JSON_JS}};
        const weeklyDataStr = {{WEEKLY_JSON_JS}};
        const monthlyDataStr = {{MONTHLY_JSON_JS}};
        const reductionDataStr = {{REDUCTION_JSON_JS}};
        
        // è§£æJSONå­—ç¬¦ä¸²
        let currentData = [];
        let weeklyReport = [];
        let monthlyReport = [];
        let reductionData = [];
        
        try {
            currentData = JSON.parse(allDataStr);
            weeklyReport = JSON.parse(weeklyDataStr);
            monthlyReport = JSON.parse(monthlyDataStr);
            reductionData = JSON.parse(reductionDataStr);
        } catch (e) {
            console.error('è§£æJSONæ•°æ®å¤±è´¥:', e);
        }
        
        // è®¡ç®—å½“å‰æ€»æŠ½å¡æ¬¡æ•°ï¼ˆåŸºäºæœ€è¿‘ä¸€å¤©çš„ç»“æŸé’è¾‰çŸ³ï¼‰
        let currentTotalDraws = 0;
        if (currentData.length > 0) {
            const latestDay = currentData[0];
            currentTotalDraws = Math.floor(latestDay.end_diamond / 120);
        }
        
        // å¯¼èˆªåŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            // å¯¼èˆªé“¾æ¥ç‚¹å‡»äº‹ä»¶
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    navLinks.forEach(l => l.classList.remove('active'));
                    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                    
                    // æ·»åŠ activeç±»åˆ°å½“å‰é“¾æ¥å’Œå¯¹åº”åŒºåŸŸ
                    this.classList.add('active');
                    const sectionId = this.getAttribute('data-section');
                    document.getElementById(sectionId).classList.add('active');
                });
            });
            
            // åˆå§‹åŒ–è¡¨æ ¼
            if (currentData.length > 0) {
                updateTable();
            }
            
            // æ˜¾ç¤ºå½“å‰æ€»æŠ½å¡æ¬¡æ•°ï¼ˆå›ºå®šå€¼ï¼Œä¸éšè¿‡æ»¤å˜åŒ–ï¼‰
            document.getElementById('current-total-draws').textContent = currentTotalDraws.toLocaleString();
        });
        
        // æ›´æ–°æŒ‰é’®æ¿€æ´»çŠ¶æ€
        function updateActiveButton(event, range) {
            document.querySelectorAll('.date-filter button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }
        
        // è¿‡æ»¤æ•°æ®å¹¶æ›´æ–°æ˜¾ç¤º
        function filterData(range) {
            updateActiveButton(event, range);
            
            const now = new Date();
            let filteredData;
            
            switch(range) {
                case 'week':
                    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    filteredData = currentData.filter(item => new Date(item.datetime) >= weekAgo);
                    break;
                case 'month':
                    const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                    filteredData = currentData.filter(item => new Date(item.datetime) >= monthAgo);
                    break;
                case 'year':
                    const yearAgo = new Date(now.getTime() - 365 * 24 * 60 * 60 * 1000);
                    filteredData = currentData.filter(item => new Date(item.datetime) >= yearAgo);
                    break;
                default:
                    filteredData = [...currentData];
            }
            
            // æŒ‰æ—¥æœŸé™åºæ’åº
            filteredData.sort((a, b) => new Date(b.datetime) - new Date(a.datetime));
            updateFilteredTable(filteredData);
            updateStats(filteredData);
        }
        
        // è¿‡æ»¤é’è¾‰çŸ³å‡å°‘é‡æ•°æ®
        function filterReductionData(range) {
            updateActiveButton(event, range);
            
            const now = new Date();
            let filteredData;
            
            switch(range) {
                case 'week':
                    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    filteredData = reductionData.filter(item => new Date(item.datetime) >= weekAgo);
                    break;
                case 'month':
                    const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                    filteredData = reductionData.filter(item => new Date(item.datetime) >= monthAgo);
                    break;
                case 'year':
                    const yearAgo = new Date(now.getTime() - 365 * 24 * 60 * 60 * 1000);
                    filteredData = reductionData.filter(item => new Date(item.datetime) >= yearAgo);
                    break;
                default:
                    filteredData = [...reductionData];
            }
            
            // æŒ‰æ—¥æœŸé™åºæ’åº
            filteredData.sort((a, b) => new Date(b.datetime) - new Date(a.datetime));
            updateReductionTable(filteredData);
            updateReductionStats(filteredData);
        }
        
        // æ›´æ–°é’è¾‰çŸ³å‡å°‘é‡è¡¨æ ¼
        function updateReductionTable(filteredData) {
            const tableBody = document.getElementById('reduction-body');
            tableBody.innerHTML = '';
            
            filteredData.forEach(item => {
                const row = document.createElement('tr');
                
                const formatNumber = (num) => {
                    return num.toLocaleString();
                };
                
                row.innerHTML = `
                    <td>${item.date}</td>
                    <td>${formatNumber(item.previous_end_diamond)}</td>
                    <td>${formatNumber(item.start_diamond)}</td>
                    <td class="ba-negative">${formatNumber(item.reduction)}</td>
                    <td class="ba-warning">${formatNumber(item.draws)} æŠ½</td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        // æ›´æ–°é’è¾‰çŸ³å‡å°‘é‡ç»Ÿè®¡
        function updateReductionStats(filteredData) {
            if (!filteredData || filteredData.length === 0) {
                document.getElementById('total-reduction').textContent = '0';
                document.getElementById('reduction-draws').textContent = '0 æŠ½';
                document.getElementById('reduction-days').textContent = '0';
                return;
            }
            
            const totalReduction = filteredData.reduce((sum, item) => sum + item.reduction, 0);
            const totalDraws = filteredData.reduce((sum, item) => sum + item.draws, 0);
            
            document.getElementById('total-reduction').textContent = totalReduction.toLocaleString();
            document.getElementById('reduction-draws').textContent = totalDraws.toLocaleString() + ' æŠ½';
            document.getElementById('reduction-days').textContent = filteredData.length;
        }
        
        // æ›´æ–°è¡¨æ ¼
        function updateTable() {
            // åˆå§‹æ˜¾ç¤ºæ‰€æœ‰æ•°æ®
            updateFilteredTable(currentData);
        }
        
        // æ›´æ–°è¿‡æ»¤åçš„è¡¨æ ¼
        function updateFilteredTable(filteredData) {
            const tableBody = document.getElementById('table-body');
            tableBody.innerHTML = '';
            
            filteredData.forEach(item => {
                const row = document.createElement('tr');
                
                // æ ¼å¼åŒ–æ•°å­—
                const formatNumber = (num) => {
                    if (num >= 1000) {
                        return num.toLocaleString();
                    }
                    return num;
                };
                
                const baahDiamondClass = item.baah_diamond_gain >= 0 ? 'ba-positive' : 'ba-negative';
                const netDiamondClass = item.net_diamond_gain >= 0 ? 'ba-positive' : 'ba-negative';
                const baahCreditClass = item.baah_credit_gain >= 0 ? 'ba-positive' : 'ba-negative';
                const netCreditClass = item.net_credit_gain >= 0 ? 'ba-positive' : 'ba-negative';
                
                row.innerHTML = `
                    <td>${item.date}</td>
                    <td>${item.start_diamond}</td>
                    <td>${item.end_diamond}</td>
                    <td class="${baahDiamondClass}">${item.baah_diamond_gain}</td>
                    <td class="${netDiamondClass}">${item.net_diamond_gain}</td>
                    <td>${formatNumber(item.start_credit)}</td>
                    <td>${formatNumber(item.end_credit)}</td>
                    <td class="${baahCreditClass}">${formatNumber(item.baah_credit_gain)}</td>
                    <td class="${netCreditClass}">${formatNumber(item.net_credit_gain)}</td>
                    <td>${item.duration_minutes.toFixed(2)}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats(filteredData) {
            if (!filteredData || filteredData.length === 0) {
                document.getElementById('total-days').textContent = '0';
                document.getElementById('total-baah-diamond').textContent = '0';
                document.getElementById('total-net-diamond').textContent = '0';
                document.getElementById('total-draws').textContent = '0';
                document.getElementById('total-baah-credit').textContent = '0';
                document.getElementById('total-reduction').textContent = '0';
                document.getElementById('reduction-draws').textContent = '0 æŠ½';
                document.getElementById('reduction-days').textContent = '0';
                document.getElementById('avg-baah-diamond').textContent = '0.00';
                document.getElementById('avg-net-diamond').textContent = '0.00';
                document.getElementById('avg-baah-credit').textContent = '0';
                document.getElementById('avg-duration').textContent = '0.00';
                return;
            }
            
            const totalDays = filteredData.length;
            
            // è¿‡æ»¤æ‰è´Ÿæ•°æ•°æ®è®¡ç®—å¹³å‡å€¼
            const positiveBaahDays = filteredData.filter(item => item.baah_diamond_gain > 0);
            const positiveNetDays = filteredData.filter(item => item.net_diamond_gain > 0);
            const positiveCreditDays = filteredData.filter(item => item.baah_credit_gain > 0);
            const positiveDurationDays = filteredData.filter(item => item.duration_minutes > 0);
            
            const totalBaahDiamond = filteredData.reduce((sum, item) => sum + item.baah_diamond_gain, 0);
            const totalNetDiamond = filteredData.reduce((sum, item) => sum + item.net_diamond_gain, 0);
            const totalBaahCredit = filteredData.reduce((sum, item) => sum + item.baah_credit_gain, 0);
            const totalNetCredit = filteredData.reduce((sum, item) => sum + item.net_credit_gain, 0);
            
            const avgBaahDiamond = positiveBaahDays.length > 0 ? 
                positiveBaahDays.reduce((sum, item) => sum + item.baah_diamond_gain, 0) / positiveBaahDays.length : 0;
            const avgNetDiamond = positiveNetDays.length > 0 ? 
                positiveNetDays.reduce((sum, item) => sum + item.net_diamond_gain, 0) / positiveNetDays.length : 0;
            const avgBaahCredit = positiveCreditDays.length > 0 ? 
                positiveCreditDays.reduce((sum, item) => sum + item.baah_credit_gain, 0) / positiveCreditDays.length : 0;
            const avgDuration = positiveDurationDays.length > 0 ? 
                positiveDurationDays.reduce((sum, item) => sum + item.duration_minutes, 0) / positiveDurationDays.length : 0;
            
            // è®¡ç®—é’è¾‰çŸ³å‡å°‘é‡
            const sortedData = [...filteredData].sort((a, b) => new Date(a.datetime) - new Date(b.datetime));
            let totalReduction = 0;
            let reductionDays = 0;
            
            for (let i = 1; i < sortedData.length; i++) {
                const reduction = sortedData[i-1].end_diamond - sortedData[i].start_diamond;
                if (reduction > 0) {
                    totalReduction += reduction;
                    reductionDays++;
                }
            }
            
            // è®¡ç®—æŠ½å¡æ¬¡æ•°
            const totalDraws = Math.floor(totalNetDiamond / 120);
            const reductionDraws = Math.floor(totalReduction / 120);
            
            // å°†ä¿¡ç”¨ç‚¹è½¬æ¢ä¸ºä¸‡ä¸ºå•ä½ï¼ˆåªå–æ•´æ•°éƒ¨åˆ†ï¼‰
            const totalBaahCreditWan = Math.round(totalBaahCredit / 10000);
            const avgBaahCreditWan = Math.round(avgBaahCredit / 10000);
            
            document.getElementById('total-days').textContent = totalDays;
            document.getElementById('total-baah-diamond').textContent = totalBaahDiamond;
            document.getElementById('total-net-diamond').textContent = totalNetDiamond;
            document.getElementById('total-draws').textContent = totalDraws.toLocaleString();
            document.getElementById('total-baah-credit').textContent = totalBaahCreditWan;
            document.getElementById('total-reduction').textContent = totalReduction.toLocaleString();
            document.getElementById('reduction-draws').textContent = reductionDraws.toLocaleString() + ' æŠ½';
            document.getElementById('reduction-days').textContent = reductionDays;
            
            document.getElementById('avg-baah-diamond').textContent = avgBaahDiamond.toFixed(2);
            document.getElementById('avg-net-diamond').textContent = avgNetDiamond.toFixed(2);
            document.getElementById('avg-baah-credit').textContent = avgBaahCreditWan;
            document.getElementById('avg-duration').textContent = avgDuration.toFixed(2);
            
            // å½“å‰æ€»æŠ½å¡æ¬¡æ•°ä¸éšè¿‡æ»¤å˜åŒ–ï¼Œä¿æŒåŸå€¼
            document.getElementById('current-total-draws').textContent = currentTotalDraws.toLocaleString();
        }
    </script>
</body>
</html>